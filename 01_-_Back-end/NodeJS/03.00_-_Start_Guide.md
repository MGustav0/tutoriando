# Guia de InicializaÃ§Ã£o de Projeto

Este guia visa mostrar o passo a passo para inicializaÃ§Ã£o de uma aplicaÃ§Ã£o NodeJS com TypeScript, com as configuraÃ§Ãµes iniciais para um projeto, sem autenticaÃ§Ã£o e sem envio de e-mails.

## Requisitos

1. Ter Yarn v1 instalado;
2. Ter o NodeJS LTS instalado.

## Criando o Projeto

1. Criar um pasta com o para o projeto.

2. Criar o projeto, digitar no terminal dentro da pasta do projeto `yarn init` e configurar as opÃ§Ãµes desejadas.

Adicionar no `package.json`:

```json
"scripts": {
    "build": "tsc",
    "dev:server": "ts-node-dev -r tsconfig-paths/register --inspect --transpile-only --ignore-watch node_modules src/shared/infra/http/server.ts",
    "start": "ts-node -r tsconfig-paths/register src/shared/infra/http/index.ts",
    "typeorm": "ts-node-dev -r tsconfig-paths/register ./node_modules/typeorm/cli.js",
    "test": "jest"
  },
  "dependencies": {},
  "devDependencies": {}
```

## DependÃªncias

Instale as seguintes dependÃªncias para:

- TypeScript
- Express
- Cors
- Celebrate
- Meta datas
- DotEnv
- Jest
- PostgreSQL
- TypeORM
- Tipos para as bibliotecas.

### ProduÃ§Ã£o

```zsh 
yarn add celebrate class-transformer cors date-fns dotenv express express-async-errors pg reflect-metadata tsyringe typeorm
```

### Desenvolvimento

```zsh
yarn add @types/jest @types/node jest ts-jest ts-node-dev typescript -D
```
## ConfiguraÃ§Ãµes

### TypeScript

Gerar o arquivo de configuraÃ§Ã£o do TypeScript: `yarn tsc --init`;

Acessar o arquivo `/tsconfig.json` que fora gerado, apagar tudo e colocar:

```js
{
  "compilerOptions": {
    "target": "es2017",
    "module": "commonjs",
    "lib": ["es6"],
    "allowJs": true,
    "outDir": "./dist",
    "rootDir": ".",
    "removeComments": true,
    "typeRoots": ["./node_modules/@types", "./src/@types"],
    "esModuleInterop": true,
    "resolveJsonModule": true,
    "experimentalDecorators": true,
    "strictPropertyInitialization": false,
    "emitDecoratorMetadata": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": "./src/",
    "paths": {
      "@modules/*": ["modules/*"],
      "@config/*": ["config/*"],
      "@shared/*": ["shared/*"]
    }
  }
}
```

Agora vocÃª pode importar arquivos usando `@path\(...)`, exemplo: `@modules/users`.

### Jest

```zsh
yarn jest --init
```

Selecionar as seguintes opÃ§Ãµes:

```zsh
âœ” Would you like to use Typescript for the configuration file? â€¦ yes
âœ” Choose the test environment that will be used for testing â€º node
âœ” Do you want Jest to add coverage reports? â€¦ no
âœ” Which provider should be used to instrument code for coverage? â€º babel
âœ” Automatically clear mock calls and instances between every test? â€¦ yes
```

Copiar [esta configuraÃ§Ã£o]([link](https://github.com/MGustav0/tutoriando/blob/master/01_-_Back-end/NodeJS/03.01_-_jest.config.md)) para o `jest.config.ts`:

### GitIgnore

```gitignore
node_modules/

.vscode/

dist/
temp/
coverage/

tmp/*
!tmp/.gitkeep
```

### Configurar VSCode

Seguir [esta configuraÃ§Ã£o]([link](https://github.com/MGustav0/tutoriando/blob/master/07_-_Code_Formatters/01_-_VSCode.md)).

### ESLint

Seguir [esta configuraÃ§Ã£o]([link](https://github.com/MGustav0/tutoriando/blob/master/07_-_Code_Formatters/02_-_ESLint_-_NodeJS.md)).

### Prettier

Seguir [esta configuraÃ§Ã£o]([link](https://github.com/MGustav0/tutoriando/blob/master/07_-_Code_Formatters/03_-_Prettier.md)).

## Estrutura de pastas

Criar a pasta `/src` e o arquivo `src/shared/infra/http/server.ts`, pode ter outros nomes, mas como geralmente o node Ã© o servidor da aplicaÃ§Ã£o, pode-se utilizar esse nome e caminho.

A pasta `/dist` serÃ¡ criada automaticamente a partir do comando no `package.json`, nela ficarÃ¡ a build da aplicaÃ§Ã£o. Para converter o arquivo para o de distribuiÃ§Ã£o no formato JavaScript use: `yarn tsc`.

Digite `yarn build` no terminal para fazer o build da aplicaÃ§Ã£o.

Digite `yarn dev:server` no terminal para fazer inicializar o servidor como desenvolvedor.

## Express

Configurar o servidor Ã© uma das coisas primÃ¡rias Ã  se fazer, pois esse arquivo nÃ£o serÃ¡ alterado constantemente.

ConfiguraÃ§Ã£o base:

```js
import 'reflect-metadata';
import 'dotenv/config';

import express from 'express';
import cors from 'cors';
import { errors } from 'celebrate';
import 'express-async-errors';

const app = express();

app.use(cors());

app.use(express.json());

app.use(errors());

app.listen(3333, () => {
  console.log(`ğŸš€ Server started on port 3333!`);
});

```

## InjeÃ§Ã£o de dependÃªncias

O tsyringe nos permitirÃ¡ automatizar a injeÃ§Ã£o de dependÃªncias.

Com isto poderemos injetar as dependÃªncias sem a necessidade de passar manualmente o repositÃ³rio no constructor do service, fazendo desta forma:

```js
@inserirDecorator
```

Mais sobre injeÃ§Ã£o de dependÃªncias no capÃ­tulo **NOME DO CAPÃTULO**

## SeguranÃ§a

CORS (Cross-Origin Resource Sharing), Ã© um middleware que permite que um site acesse recursos de outro site mesmo estando em domÃ­nios diferentes. Um site sÃ³ pode ser chamado por outro site se os 2 sites estiverem sob o mesmo domÃ­nio, o que limita a chamada de APIs REST por aplicaÃ§Ãµes JS, por exemplo, hospedadas em servidores diferentes.

Evita que outros front-ends faÃ§am requisiÃ§Ãµes Ã  Api.

No _server.ts_, deixar ele vazio, permite acesso irrestrito:

```js
import cors from 'cors';

//(...)

middlewares() {
    this.server.use(cors());
  }
```

Para colocar os endereÃ§os autorizados por exemplo:

```js
middlewares() {
    this.server.use(cors({
      'http://localhost:3000'
    }));
  }
```

**Reinicie o VSCode.**
